<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MCP Status</title>
    <style>
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        margin: 2rem;
      }
      .card {
        max-width: 720px;
        padding: 1.5rem;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .status {
        margin-top: 1rem;
        padding: 0.75rem;
        border-radius: 6px;
        border: 1px solid #ddd;
        background: #fafafa;
      }
      .muted {
        color: #666;
      }
      a {
        color: #1f6feb;
        text-decoration: none;
      }
      ul {
        margin: 0.5rem 0 0 1.25rem;
      }
      label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.25rem;
      }
      textarea,
      select {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 6px;
      }
      .row {
        margin: 0.75rem 0;
      }
      .actions {
        margin-top: 1rem;
        display: flex;
        gap: 0.75rem;
        align-items: center;
      }
      button {
        padding: 0.6rem 1rem;
        border: 0;
        border-radius: 6px;
        background: #1f6feb;
        color: #fff;
        cursor: pointer;
      }
      .notice {
        background: #e7f3ff;
        border: 1px solid #b6d8ff;
        padding: 0.75rem;
        border-radius: 6px;
        margin-top: 1rem;
      }
      .notice.error {
        background: #fee2e2;
        border-color: #fecaca;
      }
      pre {
        margin: 0.5rem 0 0 0;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 6px;
        background: #fff;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>MCP Status</h1>

      <div class="status">
        <div>
          MCP server status:
          <strong th:text="${running} ? 'Running' : 'Not running'">Running</strong>
        </div>

        <div style="margin-top: 0.75rem">
          Available tools:
          <div class="muted" th:if="${#lists.isEmpty(tools)}">(none)</div>
          <ul th:if="${!#lists.isEmpty(tools)}">
            <li th:each="tool : ${tools}" th:text="${tool}">search</li>
          </ul>
        </div>

        <div style="margin-top: 0.75rem">
          <a th:href="@{/}">Back to Dashboard</a>
        </div>
      </div>

      <div class="status" style="margin-top: 1rem">
        <h2 style="margin: 0 0 0.5rem 0; font-size: 1.1rem">write_observation (test)</h2>

        <div class="notice" th:if="${writeObservationSuccessMessage}">
          <div th:text="${writeObservationSuccessMessage}">Observation saved.</div>
          <div class="muted" style="margin-top: 0.5rem">
            <a th:href="@{/observations}">View in Observations</a>
          </div>
        </div>
        <div class="notice error" th:if="${writeObservationErrorMessage}" th:text="${writeObservationErrorMessage}"></div>

        <div class="muted" th:if="${writeObservationResult}">
          Saved observation result:
          <pre
            th:text="${'id: ' + writeObservationResult.id + '\nsubtype: ' + writeObservationResult.subtype + '\ncreatedAt: ' + writeObservationResult.createdAt + '\n\n' + writeObservationResult.text}"
          ></pre>
        </div>

        <form th:action="@{/mcp/write-observation}" method="post">
          <div class="row">
            <label for="subtype">Subtype</label>
            <select id="subtype" name="subtype">
              <option
                th:each="s : ${subtypes}"
                th:value="${s.key()}"
                th:text="${s.key()}"
                th:selected="${s.key() == writeObservationSubtype}"
              ></option>
            </select>
          </div>

          <div class="row">
            <label for="text">Text</label>
            <textarea id="text" name="text" rows="4" th:text="${writeObservationText}"></textarea>
          </div>

          <div class="actions">
            <button type="submit">Run write_observation</button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
