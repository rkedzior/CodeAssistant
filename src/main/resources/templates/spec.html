<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Spec Manager</title>
    <style>
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        margin: 2rem;
      }
      .card {
        max-width: 1100px;
        padding: 1.5rem;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      a {
        color: #1f6feb;
        text-decoration: none;
      }
      .actions {
        margin: 1rem 0 1.25rem 0;
        display: flex;
        gap: 0.75rem;
        align-items: center;
      }
      .btn {
        appearance: none;
        border: 1px solid #ddd;
        background: #fff;
        border-radius: 6px;
        padding: 0.35rem 0.6rem;
        cursor: pointer;
        font: inherit;
      }
      .btn:hover {
        background: #fafafa;
      }
      .notice {
        background: #e7f3ff;
        border: 1px solid #b6d8ff;
        padding: 0.75rem;
        border-radius: 6px;
        margin: 1rem 0;
      }
      .error {
        background: #ffecec;
        border: 1px solid #f5b5b5;
        padding: 0.75rem;
        border-radius: 6px;
        margin: 1rem 0;
        color: #8a1f1f;
      }
      .layout {
        display: grid;
        grid-template-columns: 340px 1fr;
        gap: 1rem;
        align-items: start;
      }
      @media (max-width: 900px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }
      .panel {
        border: 1px solid #eee;
        border-radius: 6px;
        padding: 1rem;
        background: #fafafa;
      }
      .files {
        max-height: 70vh;
        overflow: auto;
      }
      ul {
        list-style: none;
        padding: 0;
        margin: 0.75rem 0 0 0;
      }
      li {
        margin: 0.35rem 0;
      }
      .fileLink {
        display: block;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        font-size: 0.95rem;
        padding: 0.35rem 0.5rem;
        border-radius: 6px;
      }
      .fileLink.active {
        background: #e7f3ff;
        border: 1px solid #b6d8ff;
      }
      .muted {
        color: #666;
      }
      pre {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        background: #fff;
        border: 1px solid #eee;
        border-radius: 6px;
        padding: 1rem;
        white-space: pre;
        overflow: auto;
        max-height: 70vh;
        margin: 0.75rem 0 0 0;
      }
      .path {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        font-size: 0.95rem;
        color: #333;
        margin-top: 0.35rem;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Spec Manager</h1>

      <div class="notice" th:if="${successMessage}" th:text="${successMessage}"></div>

      <div class="actions">
        <a th:href="@{/}">Dashboard</a>
        <form th:if="${configured}" th:action="@{/spec/propose-updates}" method="post" style="margin: 0">
          <input type="hidden" name="path" th:value="${path}" />
          <button class="btn" type="submit">Propose updates</button>
        </form>
      </div>

      <div class="notice" th:if="${!configured}">
        <div>Project is not configured yet.</div>
        <div class="muted">Configure the project before browsing spec files.</div>
      </div>

      <div class="error" th:if="${error != null}">
        <div th:text="${error}">Error.</div>
      </div>

      <div class="layout" th:if="${configured}">
        <div class="panel files">
          <h2 style="margin: 0">Files</h2>
          <div class="muted" style="margin-top: 0.5rem" th:if="${files.isEmpty()}">
            No Markdown files found under <strong>spec/</strong>.
          </div>
          <ul th:if="${!files.isEmpty()}">
            <li th:each="f : ${files}">
              <a
                class="fileLink"
                th:classappend="${f == path} ? ' active' : ''"
                th:href="@{/spec(path=${f})}"
                th:text="${f}"
                >spec/file.md</a
              >
            </li>
          </ul>
        </div>

        <div class="panel">
          <h2 style="margin: 0">Content</h2>
          <div class="muted" style="margin-top: 0.5rem" th:if="${path == ''}">
            Select a file to view its content.
          </div>
          <div class="path" th:if="${path != ''}" th:text="${path}">spec/file.md</div>
          <pre th:if="${error == null and content != null}" th:text="${content}">content</pre>
        </div>
      </div>

      <div class="panel" style="margin-top: 1rem" th:if="${configured and proposals != null}">
        <h2 style="margin: 0">Proposed updates</h2>
        <div class="muted" style="margin-top: 0.5rem" th:if="${proposals.isEmpty()}">
          No proposals available (save at least one observation first).
        </div>
        <form th:if="${!proposals.isEmpty()}" th:action="@{/spec/apply-updates}" method="post">
          <input type="hidden" name="path" th:value="${path}" />
          <div class="actions" style="margin: 0.75rem 0 0 0">
            <button class="btn" type="submit">Apply updates</button>
          </div>

          <div th:each="p : ${proposals}" style="margin-top: 1rem">
            <label style="display: flex; align-items: baseline; gap: 0.5rem">
              <input type="checkbox" name="paths" th:value="${p.path()}" checked />
              <span class="path" th:text="${p.path()}">spec/file.md</span>
            </label>
            <pre th:text="${p.proposedContent()}">proposed content</pre>
            <div class="muted" th:if="${p.rationale() != null}" th:text="${p.rationale()}"></div>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
