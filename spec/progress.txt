2025-12-28
- BL-0001 complete: Maven Spring Boot + Thymeleaf skeleton; `GET /` shows “Dashboard”; `GET /health` returns `{status: ok}`.
- Tests: `DashboardSmokeTest`, `HealthSmokeTest` via MockMvc with `@ActiveProfiles("test")` (run: `.\mvnw.cmd test`).
Observations / short memory:
- Chose Maven + Java 17 bytecode (runs on local JDK 21 OK).
- Package root: `app.platform` (per HLD).
- Mockito emits JDK dynamic-agent warning during tests; not addressed yet.

- BL-0101 complete: Project Setup UI (`GET/POST /setup`) with validation; config persisted to `./.codeassistant/config.json`; Dashboard shows “Configured”.
- Tests: `ProjectSetupFlowTest` (local setup, GitHub setup, invalid GitHub id) under `test` profile using in-memory config adapter.
Observations:
- Runtime config folder `.codeassistant/` is gitignored; file-backed adapter disabled in `test` profile.

- BL-0102 complete: vector-store state bootstrap via `metadata.json` with attributes `type=documentation`, `subtype=metadata`; `GET /api/metadata` added.
- UI: Dashboard shows “Last indexed commit: Not indexed” when empty.
- Tests: `MetadataApiTest` + updated `DashboardSmokeTest`.
Observations:
- Implemented a minimal local filesystem “vector store” under `.codeassistant/vectorstore/` for non-test profiles; tests use in-memory vector store.

- BL-0201 complete: Indexing page (`/index`) + initial index job; REST `POST /api/index/initial` + `GET /api/index/status`; metadata `lastIndexedCommit` updated from `git rev-parse HEAD`.
- Tests: `IndexingFlowTest` creates a temp git repo, starts job, asserts progress changes while RUNNING, and dashboard displays the commit hash.
Observations:
- Index job runner is in-memory/single-job (OK for MVP); uses Spring `applicationTaskExecutor`.

- BL-0202 complete: tracked-file enumeration via `git ls-files`; API `GET /api/index/tracked-files` added.
- Tests: `TrackedFilesApiTest` verifies ignored/untracked file is excluded.

- BL-0203 complete: initial index uploads classified tracked files to vector store with attributes (`type`, `subtype`, `path`); API `GET /api/vectorstore/files` added.
- Tests: extended `IndexingFlowTest` validates uploaded code (`business_logic`) and spec (`documentation/spec`) + `/api/metadata` lastIndexedCommit.
Observations:
- Vector-store fileId is `repo_<sha256(path)>` to keep IDs filesystem-safe; original path preserved in attributes.

- BL-0301 complete: exact text search via `TextSearchPort` + `RipgrepTextSearchAdapter` (`rg`-first, Java fallback); UI `/search`; API `GET /api/search/text`.
- Tests: `TextSearchApiTest` verifies tracked match returned and gitignored match excluded (forces Java fallback in `test` profile).

- BL-0302 complete: regex mode added to text search (`regex=true`); invalid regex returns 400 (API) and shows error banner (UI).
- Tests: extended `TextSearchApiTest` covers regex happy path (`foo\\s+bar`) and invalid regex (`foo(`).

- BL-0401 complete: semantic search mode added (UI `/search?mode=semantic` + API `GET /api/search/semantic?query=...&k=...`) returning ranked results.
- Tests: `SemanticSearchApiTest` covers ranking and HTML rendering under `test` profile.
Observations:
- MVP semantic search is local deterministic token-hash cosine scoring over vector-store file contents (no OpenAI/network); ready for BL-0402 filters via `filters` param.

- BL-0402 complete: semantic search supports attribute filters `type`/`subtype` (UI controls + API query params) to narrow results (e.g., `documentation/spec`).
- Tests: extended `SemanticSearchApiTest` validates filtered API/HTML returns only `/spec` Markdown when `type=documentation&subtype=spec`.

- BL-0501 complete: file viewer added (`GET /file?path=...`) showing file content plus current indexed commit; search results link to the viewer.
- Tests: `FileViewerFlowTest` verifies `/file` renders content + commit and `/search` includes `/file?path=...` link.

- BL-0601 complete: Analysis workspace added (`/analysis`) + REST `POST /api/analysis` returning answer + retrieved context (code-scope filters to `type=code`).
- Tests: `AnalysisFlowTest` covers API response (non-empty answer/context) and UI rendering under `test` profile.
Observations:
- Analysis uses deterministic local stub LLM (no network) + semantic retrieval via `SemanticSearchPort`.

- BL-0602 complete: analysis errors surfaced consistently (UI banner + API 400) and retry supported via fault injection (`codeassistant.llm.failOnce=true`).
- Tests: `AnalysisRetryFlowTest` validates first-call failure and second-call success (API + UI).

- BL-0701 complete: Observations added (UI `/observations` + API `POST/GET /api/observations`) stored in vector store as `type=observation` with `subtype`.
- Tests: `ObservationsFlowTest` covers API create/list + UI save/list under `test` profile.

- BL-0702 complete: observation list supports keyword filtering (`q`) in UI (`GET /observations?q=...`) and API (`GET /api/observations?q=...`) via case-insensitive substring match on text.
- Tests: extended `ObservationsFlowTest` covers API and UI filtering (case-insensitive) under `test` profile.
Observations:
- Implemented filtering in delivery layer (kept `ObservationsPort` unchanged) for MVP simplicity.

- BL-0801 complete: Spec Manager added (UI `/spec`) to browse configured repo `/spec/*.md` files and view content; API `GET /api/spec/files` + `GET /api/spec/file?path=...` added with path traversal protection.
- Tests: `SpecBrowsingTest` covers API list/read + traversal rejection and UI rendering under `test` profile.
Observations:
- Spec browsing reads from the configured local repo root (`ProjectConfig.localRepoPath`) rather than this app’s own working tree.

- BL-0802 complete: spec update proposals generated from observations (deterministic) and displayed grouped by spec file; API `POST /api/spec/propose-updates` and UI `POST /spec/propose-updates` added.
- Tests: `SpecProposeUpdatesFlowTest` covers API + UI proposals including observation text under `test` profile.
Observations:
- Proposal algorithm is intentionally simple (appends an “updates from observations” section) to keep MVP deterministic/offline.

- BL-0803 complete: apply flow added to write accepted proposals into repo `/spec/*.md` working tree; API `POST /api/spec/apply-updates` and UI `POST /spec/apply-updates` added with success banner.
- Tests: `SpecApplyUpdatesFlowTest` covers API apply (writes file) and UI apply (success flash + redirect) under `test` profile.
Observations:
- Apply recomputes deterministic proposals and writes only selected paths (no server-side proposal persistence).

- BL-0901 complete: indexing can be updated to a target commit hash via UI (commit input + confirm) and API `POST /api/index/update`; metadata `lastIndexedCommit` updates to target commit on success.
- Tests: `UpdateIndexFlowTest` covers update A→X via temp git repo and verifies `/api/metadata` lastIndexedCommit == X under `test` profile.
Observations:
- Git adapter reads file content at specific commits via `git show`/`git ls-tree` (no working-tree checkout required for update job).

- BL-0902 complete: full reload indexing to a target commit hash via UI “Full reload” and API `POST /api/index/reload`; metadata `lastIndexedCommit` updates to target commit on success.
- Tests: `ReloadIndexFlowTest` covers reload A→X and `/index` reload control under `test` profile.

- BL-1001 complete: MCP Status page (`/mcp`) added with tool list and server status; API `GET /api/mcp/status` returns `{running, tools}` including `search` and `write_observation`.
- Tests: `McpStatusPageTest` + `McpStatusApiTest` cover UI/API under `test` profile.

- BL-1002 complete: MCP search tool available via `POST /api/mcp/search` supporting `mode=text|semantic` and reusing existing search ports.
- Tests: `McpSearchApiTest` covers MCP text and semantic search modes under `test` profile.

- BL-1003 complete: MCP `write_observation` tool implemented via API `POST /api/mcp/write_observation` and a test action form on `/mcp`; saved observations are visible on `/observations`.
- Tests: `McpWriteObservationFlowTest` covers API and MCP Status form flow under `test` profile.

- BL-1101 complete: end-to-end happy path verified via a single integration test covering configure → index → text search → analysis → observation → spec propose/apply.
- Tests: `EndToEndHappyPathTest` covers the combined MVP workflow under `test` profile.

- BL-1102 complete: resilience added for missing `metadata.json` in vector store (treated as absent and recreated); dashboard shows “Not indexed” and reindex succeeds.
- Tests: `MetadataResilienceTest` covers metadata deletion/recreation + reindex under `test` profile.
